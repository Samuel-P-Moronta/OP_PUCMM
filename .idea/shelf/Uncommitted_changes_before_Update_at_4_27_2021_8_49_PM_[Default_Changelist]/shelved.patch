Index: build/tmp/compileJava/source-classes-mapping.txt
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>oppucmm/models/RoleApp.java\r\n oppucmm.models.RoleApp\r\noppucmm/services/connect/DataBaseRepository.java\r\n oppucmm.services.connect.DataBaseRepository\r\noppucmm/models/Location.java\r\n oppucmm.models.Location\r\noppucmm/services/UserService.java\r\n oppucmm.services.UserService\r\noppucmm/controllers/FormController.java\r\n oppucmm.controllers.FormController\r\noppucmm/webservices/SOAP/Server/SOAPController.java\r\n oppucmm.webservices.SOAP.Server.SOAPController\r\noppucmm/controllers/ControladorBase.java\r\n oppucmm.controllers.ControladorBase\r\noppucmm/services/FormService.java\r\n oppucmm.services.FormService\r\noppucmm/controllers/UserController.java\r\n oppucmm.controllers.UserController\r\noppucmm/services/connect/DataBaseServices.java\r\n oppucmm.services.connect.DataBaseServices\r\noppucmm/controllers/OpPucmmException.java\r\n oppucmm.controllers.OpPucmmException\r\noppucmm/models/User.java\r\n oppucmm.models.User\r\noppucmm/webservices/REST/Server/JWT.java\r\n oppucmm.webservices.REST.Server.JWT\r\noppucmm/webservices/REST/Client/RESTClient.java\r\n oppucmm.webservices.REST.Client.RESTClient\r\noppucmm/webservices/REST/Server/RESTApi.java\r\n oppucmm.webservices.REST.Server.RESTApi\r\noppucmm/models/FormAux.java\r\n oppucmm.models.FormAux\r\noppucmm/controllers/WebSocketController.java\r\n oppucmm.controllers.WebSocketController\r\n oppucmm.controllers.WebSocketController$1\r\noppucmm/models/Photo.java\r\n oppucmm.models.Photo\r\noppucmm/Main.java\r\n oppucmm.Main\r\noppucmm/webservices/REST/Server/Services.java\r\n oppucmm.webservices.REST.Server.Services\r\noppucmm/models/Form.java\r\n oppucmm.models.Form\r\noppucmm/webservices/REST/Server/RESTController.java\r\n oppucmm.webservices.REST.Server.RESTController\r\noppucmm/controllers/Controller.java\r\n oppucmm.controllers.Controller\r\noppucmm/webservices/SOAP/Server/SOAPService.java\r\n oppucmm.webservices.SOAP.Server.SOAPService\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/build/tmp/compileJava/source-classes-mapping.txt b/build/tmp/compileJava/source-classes-mapping.txt
--- a/build/tmp/compileJava/source-classes-mapping.txt	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/build/tmp/compileJava/source-classes-mapping.txt	(date 1619578792278)
@@ -1,49 +1,49 @@
-oppucmm/models/RoleApp.java
- oppucmm.models.RoleApp
+oppucmm/webservices/SOAP/Server/SOAPController.java
+ oppucmm.webservices.SOAP.Server.SOAPController
 oppucmm/services/connect/DataBaseRepository.java
  oppucmm.services.connect.DataBaseRepository
 oppucmm/models/Location.java
  oppucmm.models.Location
+oppucmm/Main.java
+ oppucmm.Main
+oppucmm/webservices/REST/Server/Services.java
+ oppucmm.webservices.REST.Server.Services
+oppucmm/webservices/REST/Server/RESTController.java
+ oppucmm.webservices.REST.Server.RESTController
+oppucmm/controllers/ControladorBase.java
+ oppucmm.controllers.ControladorBase
 oppucmm/services/UserService.java
  oppucmm.services.UserService
 oppucmm/controllers/FormController.java
  oppucmm.controllers.FormController
-oppucmm/webservices/SOAP/Server/SOAPController.java
- oppucmm.webservices.SOAP.Server.SOAPController
-oppucmm/controllers/ControladorBase.java
- oppucmm.controllers.ControladorBase
-oppucmm/services/FormService.java
- oppucmm.services.FormService
-oppucmm/controllers/UserController.java
- oppucmm.controllers.UserController
 oppucmm/services/connect/DataBaseServices.java
  oppucmm.services.connect.DataBaseServices
 oppucmm/controllers/OpPucmmException.java
  oppucmm.controllers.OpPucmmException
-oppucmm/models/User.java
- oppucmm.models.User
+oppucmm/webservices/SOAP/Server/SOAPService.java
+ oppucmm.webservices.SOAP.Server.SOAPService
 oppucmm/webservices/REST/Server/JWT.java
  oppucmm.webservices.REST.Server.JWT
 oppucmm/webservices/REST/Client/RESTClient.java
  oppucmm.webservices.REST.Client.RESTClient
 oppucmm/webservices/REST/Server/RESTApi.java
  oppucmm.webservices.REST.Server.RESTApi
-oppucmm/models/FormAux.java
- oppucmm.models.FormAux
 oppucmm/controllers/WebSocketController.java
  oppucmm.controllers.WebSocketController
  oppucmm.controllers.WebSocketController$1
+oppucmm/models/FormAux.java
+ oppucmm.models.FormAux
 oppucmm/models/Photo.java
  oppucmm.models.Photo
-oppucmm/Main.java
- oppucmm.Main
-oppucmm/webservices/REST/Server/Services.java
- oppucmm.webservices.REST.Server.Services
 oppucmm/models/Form.java
  oppucmm.models.Form
-oppucmm/webservices/REST/Server/RESTController.java
- oppucmm.webservices.REST.Server.RESTController
+oppucmm/controllers/UserController.java
+ oppucmm.controllers.UserController
 oppucmm/controllers/Controller.java
  oppucmm.controllers.Controller
-oppucmm/webservices/SOAP/Server/SOAPService.java
- oppucmm.webservices.SOAP.Server.SOAPService
+oppucmm/services/FormService.java
+ oppucmm.services.FormService
+oppucmm/models/User.java
+ oppucmm.models.User
+oppucmm/models/RoleApp.java
+ oppucmm.models.RoleApp
Index: src/main/java/oppucmm/webservices/REST/Server/RESTApi.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Server;\r\n\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\nimport io.javalin.Javalin;\r\nimport io.javalin.http.Context;\r\nimport io.javalin.http.ForbiddenResponse;\r\nimport io.jsonwebtoken.Claims;\r\nimport io.jsonwebtoken.ExpiredJwtException;\r\nimport io.jsonwebtoken.Jwts;\r\nimport io.jsonwebtoken.MalformedJwtException;\r\nimport io.jsonwebtoken.security.Keys;\r\n\r\nimport oppucmm.controllers.Controller;\r\nimport oppucmm.models.Form;\r\nimport oppucmm.models.FormAux;\r\nimport oppucmm.models.User;\r\nimport oppucmm.services.UserService;\r\nimport io.jsonwebtoken.security.SignatureException;\r\n\r\n\r\nimport oppucmm.webservices.REST.Client.RESTClient;\r\n\r\nimport javax.crypto.SecretKey;\r\nimport java.io.IOException;\r\nimport java.time.LocalDateTime;\r\nimport java.time.ZoneOffset;\r\nimport java.util.*;\r\n\r\nimport static io.javalin.apibuilder.ApiBuilder.*;\r\nimport static io.javalin.apibuilder.ApiBuilder.get;\r\n\r\npublic class RESTApi {\r\n    private Javalin app;\r\n    private Map<String, Object> model = new HashMap<>();\r\n    public RESTApi(Javalin app) {\r\n        this.app = app;\r\n    }\r\n    public void aplicarRutas() {\r\n        filtro_Cors();\r\n        app.routes(() -> {\r\n            /**\r\n             * Ejemplo de una API REST, implementando el CRUD\r\n             * ir a\r\n             */\r\n            path(\"/restApi\", () -> {\r\n                //Autenticar Usuario\r\n                get(\"/:autenticar\", ctx -> {\r\n\r\n                    JWT repuestaLogin = null;\r\n                    System.out.println( \"Parametro recibido: \" + ctx.pathParam(\"autenticar\"));\r\n                    User usuario = null;\r\n                    usuario = Controller.getInstance().getUserByUsername(ctx.pathParam(\"autenticar\", String.class).get());\r\n                    if(usuario!= null){\r\n                        repuestaLogin = generateJWT(usuario);\r\n                        System.out.println(\"Enviando repuesta el cliente...\");\r\n                        System.out.println(\"token -> \"+repuestaLogin.getToken());\r\n                        ctx.json(repuestaLogin);\r\n                    }else{\r\n                        ctx.json(repuestaLogin);\r\n                    }\r\n                });\r\n                path(\"/formulario\",()->{\r\n                    /*\r\n                    before(\"/addForm\",ctx -> {\r\n                        //Header for the token\r\n                        String header = \"Authorization\";\r\n                        String prefix = \"Bearer \";\r\n\r\n                        String jwt = ctx.header(header);\r\n                        if(jwt == null || !jwt.startsWith(prefix)){\r\n                            throw new ForbiddenResponse(\"Bad request! You can't access!\");\r\n                        }else{\r\n                            jwt = jwt.replace(prefix, \"\");\r\n                            Claims claims = null;\r\n                            try {\r\n                                claims = Jwts.parser().setSigningKey(Keys.hmacShaKeyFor(RESTController.KEY_SECRET.getBytes())).parseClaimsJws(jwt).getBody();\r\n                                System.out.println(\"JWT received: \" + claims.toString());\r\n\r\n                            }catch (ExpiredJwtException | MalformedJwtException | SignatureException e){\r\n                                throw new ForbiddenResponse(e.getMessage());\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                     */\r\n                    after(ctx -> {\r\n                        ctx.header(\"Content-Type\", \"application/json\");\r\n                    });\r\n                    //Agregar\r\n                    post(\"/addForm\", ctx -> {\r\n                        FormAux f = ctx.bodyAsClass(FormAux.class);\r\n                        ctx.json(Services.getInstance().addFormDb(f));\r\n                    });\r\n                    //Listar\r\n                    get(\"/listForm/:user\", ctx -> {\r\n                        System.out.println(\"Parametro: \"+ctx.pathParam(\"user\"));\r\n                        ctx.json(Services.getInstance().getFormsByUsername(ctx.pathParam(\"user\",String.class).get()));\r\n                    });\r\n                    //Listar por usuario.\r\n                    get(\"/listFormByUsername/:usuario\", ctx -> {\r\n                        System.out.println( \"Parametro recibido: \" + ctx.pathParam(\"usuario\"));\r\n                        ctx.json(Controller.getInstance().getFormByUser(ctx.pathParam(\"usuario\",String.class).get()));\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    }\r\n    /**\r\n     *  Aplicando el filtro para permitir el CORS.\r\n     *  Si estamos realizando una consulta desde un navegador es\r\n     *  necesario dar permisos de intercambio de información.\r\n     */\r\n    private void filtro_Cors(){\r\n        //  Filtro para validar el CORS.(Intercambio de recursos de origen cruzado).\r\n        app.before(\"/*\", ctx ->{\r\n            ctx.header(\"Access-Control-Allow-Origin\", \"*\");\r\n        });\r\n        // Enviando la información a solicitud del CORS.\r\n        app.options(\"/*\", ctx -> {\r\n            System.out.println(\"Accediendo al metodo de options\");\r\n\r\n            String accessControlRequestHeaders = ctx.header(\"Access-Control-Request-Headers\");\r\n            if (accessControlRequestHeaders != null) {\r\n                ctx.header(\"Access-Control-Allow-Headers\",accessControlRequestHeaders);\r\n            }\r\n\r\n            String accessControlRequestMethod = ctx.header(\"Access-Control-Request-Method\");\r\n            if (accessControlRequestMethod != null) {\r\n                ctx.header(\"Access-Control-Allow-Methods\",accessControlRequestMethod);\r\n            }\r\n            ctx.status(200).result(\"OK\");\r\n        });\r\n    }\r\n    /**\r\n     * Metodo para la generación de la trama JWT\r\n     * @param u1\r\n     * @return\r\n     */\r\n    private static JWT generateJWT(User u1){\r\n        JWT j1 = new JWT();\r\n        //Generating the key\r\n        SecretKey secretKey = Keys.hmacShaKeyFor(RESTController.KEY_SECRET.getBytes());\r\n        //Valid date\r\n        LocalDateTime localDateTime = LocalDateTime.now().plusMinutes(30);\r\n\r\n        //Generate the JWT (frame)\r\n        String jwt = Jwts.builder()\r\n                .setIssuer(\"PUCMM-FINAL-PROJECT\")\r\n                .setSubject(\"OP | PUCMM API's\")\r\n                .setExpiration(Date.from(localDateTime.toInstant(ZoneOffset.ofHours(-4))))\r\n                .claim(\"username\", u1.getUsername())\r\n                .signWith(secretKey)\r\n                .compact();\r\n        j1.setToken(jwt);\r\n        return j1;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Server/RESTApi.java b/src/main/java/oppucmm/webservices/REST/Server/RESTApi.java
--- a/src/main/java/oppucmm/webservices/REST/Server/RESTApi.java	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/java/oppucmm/webservices/REST/Server/RESTApi.java	(date 1619565628909)
@@ -88,6 +88,7 @@
                     });
                     //Agregar
                     post("/addForm", ctx -> {
+
                         FormAux f = ctx.bodyAsClass(FormAux.class);
                         ctx.json(Services.getInstance().addFormDb(f));
                     });
Index: src/main/java/oppucmm/webservices/REST/Server/Services.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Server;\r\n\r\nimport oppucmm.models.*;\r\nimport oppucmm.services.FormService;\r\nimport oppucmm.services.UserService;\r\nimport org.jetbrains.annotations.NotNull;\r\n\r\nimport java.util.List;\r\nimport java.util.Locale;\r\n\r\npublic class Services {\r\n    private static Services services = null;\r\n\r\n    private Services() {\r\n    }\r\n\r\n    public static Services getInstance() {\r\n        if (services == null) {\r\n            services = new Services();\r\n        }\r\n        return services;\r\n    }\r\n\r\n    public Form addFormDb(FormAux form) {\r\n        Form aux = null;\r\n        if (form != null) {\r\n            Location locationAux = new Location(form.getLongitude(),form.getLatitude());\r\n            Photo photo = new Photo(form.getFotoBase64());\r\n            aux = new Form(form.getFullName(), form.getSector(), form.getAcademicLevel(),locationAux,photo);\r\n            System.out.println(\"Se creo el form!!\");\r\n            FormService.getInstance().crear(aux);\r\n            return new Form();\r\n        }\r\n        return null;\r\n    }\r\n    public List<Form> getFormsByUsername(String username) {\r\n        User user = UserService.getInstance().buscar(username.trim());\r\n        List<Form> forms = null;\r\n        if (user != null) {\r\n            forms = user.formToGet(user);\r\n            forms.forEach((Form form) -> {\r\n                FormService.getInstance().getEntityManager().detach(form);\r\n            });\r\n        }\r\n        return forms;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Server/Services.java b/src/main/java/oppucmm/webservices/REST/Server/Services.java
--- a/src/main/java/oppucmm/webservices/REST/Server/Services.java	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/java/oppucmm/webservices/REST/Server/Services.java	(date 1619578753372)
@@ -1,5 +1,6 @@
 package oppucmm.webservices.REST.Server;
 
+import oppucmm.controllers.Controller;
 import oppucmm.models.*;
 import oppucmm.services.FormService;
 import oppucmm.services.UserService;
Index: src/main/java/oppucmm/models/FormAux.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.models;\r\n\r\nimport oppucmm.controllers.Controller;\r\n\r\npublic class FormAux {\r\n\r\n    private int id;\r\n    private String fotoBase64;\r\n    private String fullName;\r\n    private String sector;\r\n    private String academicLevel;\r\n    private Double latitude;\r\n    private Double longitude;\r\n    private String user;\r\n\r\n    /*Empty constructor*/\r\n    public FormAux() {\r\n    }\r\n    /*Principal Constructor*/\r\n    public FormAux(String fotoBase64,String fullName, String sector, String academicLevel, Double latitude, Double longitude, String user) {\r\n        this.id = id;\r\n        this.fotoBase64 = fotoBase64;\r\n        this.fullName = fullName;\r\n        this.sector = sector;\r\n        this.academicLevel = academicLevel;\r\n        this.latitude = latitude;\r\n        this.longitude = longitude;\r\n        this.user = user;\r\n    }\r\n    public FormAux(String fullName, String sector, String academicLevel, Double latitude, Double longitude,String fotoBase64) {\r\n        this.fotoBase64 = fotoBase64;\r\n        this.fullName = fullName;\r\n        this.sector = sector;\r\n        this.academicLevel = academicLevel;\r\n        this.latitude = latitude;\r\n        this.longitude = longitude;\r\n        this.fotoBase64 = fotoBase64;\r\n\r\n    }\r\n    /*Getters and Setters*/\r\n    public int getId() { return id; }\r\n\r\n    public void setId(int id) { this.id = id; }\r\n\r\n    public String getFullName() { return fullName; }\r\n\r\n    public void setFullName(String fullName) { this.fullName = fullName; }\r\n\r\n    public String getSector() { return sector; }\r\n\r\n    public void setSector(String sector) { this.sector = sector; }\r\n\r\n    public String getAcademicLevel() { return academicLevel; }\r\n\r\n    public Double getLatitude() { return latitude; }\r\n\r\n\r\n    public Double getLongitude() { return longitude; }\r\n\r\n    public void setLongitude(Double longitude) { this.longitude = longitude; }\r\n\r\n    public String getUser() { return user; }\r\n\r\n    public void setUser(String user) { this.user = user; }\r\n\r\n    public String getFotoBase64() {\r\n        return fotoBase64;\r\n    }\r\n\r\n    public void setFotoBase64(String fotoBase64) {\r\n        this.fotoBase64 = fotoBase64;\r\n    }\r\n\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/models/FormAux.java b/src/main/java/oppucmm/models/FormAux.java
--- a/src/main/java/oppucmm/models/FormAux.java	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/java/oppucmm/models/FormAux.java	(date 1619565628929)
@@ -2,6 +2,10 @@
 
 import oppucmm.controllers.Controller;
 
+import javax.persistence.ElementCollection;
+import javax.persistence.FetchType;
+import java.util.List;
+
 public class FormAux {
 
     private int id;
@@ -13,6 +17,9 @@
     private Double longitude;
     private String user;
 
+    @ElementCollection(fetch = FetchType.EAGER)
+    List<Photo> fotoList;
+
     /*Empty constructor*/
     public FormAux() {
     }
@@ -27,16 +34,24 @@
         this.longitude = longitude;
         this.user = user;
     }
-    public FormAux(String fullName, String sector, String academicLevel, Double latitude, Double longitude,String fotoBase64) {
+    public FormAux(String fullName, String sector, String academicLevel, Double latitude, Double longitude,List<Photo> fotoList) {
         this.fotoBase64 = fotoBase64;
         this.fullName = fullName;
         this.sector = sector;
         this.academicLevel = academicLevel;
         this.latitude = latitude;
         this.longitude = longitude;
-        this.fotoBase64 = fotoBase64;
+        this.fotoList = fotoList;
+
+    }
+    public List<Photo> getFotoList() {
+        return fotoList;
+    }
 
+    public void setFotoList(List<Photo> fotoList) {
+        this.fotoList = fotoList;
     }
+
     /*Getters and Setters*/
     public int getId() { return id; }
 
Index: src/main/java/oppucmm/webservices/REST/Client/RESTClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Client;\r\n\r\nimport com.google.gson.Gson;\r\nimport com.google.gson.JsonObject;\r\nimport kong.unirest.GenericType;\r\nimport kong.unirest.HttpResponse;\r\nimport kong.unirest.JsonNode;\r\nimport kong.unirest.Unirest;\r\nimport oppucmm.models.Form;\r\nimport oppucmm.models.FormAux;\r\nimport oppucmm.models.Photo;\r\nimport oppucmm.webservices.REST.Server.JWT;\r\n\r\nimport java.util.List;\r\n\r\npublic class RESTClient {\r\n    static String url = \"http://localhost:7000/restApi/formulario/addForm\";\r\n    static String urlMat = \"http://localhost:7000/restApi/formAdd/{matricula}\";\r\n    static String param = \"matricula\";\r\n    static String content = \"Content-Type\";\r\n    static String appJson = \"application/json\";\r\n    private static JWT j1 = null;\r\n\r\n\r\n    /* Sending form to rest server...*/\r\n    public static boolean checkUser(String usuario) {\r\n        HttpResponse<String> repuestaServidor = Unirest.get(String.valueOf(new String[]{\"http://localhost:7000/restApi/\" + \"{autenticar}\"})).routeParam(\"autenticar\", usuario).asString();\r\n        Gson gson = new Gson();\r\n        j1 = gson.fromJson(repuestaServidor.getBody(), JWT.class);\r\n        System.out.println(\"Token recibido... \" + j1.getToken());\r\n        if (j1.getToken() != null) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public static boolean addForm(FormAux form) {\r\n        System.out.println(\"\\nSend Parameters to the rest server\");\r\n        System.out.println(\"\\n Name: \" + form.getFullName() +\r\n                \" Sector: \" + form.getSector() +\r\n                \" Academic Level: \" + form.getAcademicLevel());\r\n        /*Json Image*/\r\n        JsonObject imgJSON = new JsonObject();\r\n        imgJSON.addProperty(\"fotoBase64\", form.getFotoBase64());\r\n        JsonObject st = new JsonObject();\r\n        /*Adding properties*/\r\n        st.addProperty(\"fullName\", form.getFullName());\r\n        st.addProperty(\"sector\", form.getSector());\r\n        st.addProperty(\"academicLevel\", form.getAcademicLevel());\r\n        st.addProperty(\"latitude\", form.getLatitude());\r\n        st.addProperty(\"longitude\", form.getLongitude());\r\n\r\n\r\n\r\n        HttpResponse<JsonNode> repuestaServidor = Unirest.post(\"http://localhost:7000/restApi/formulario/addForm\")\r\n                .header(\"Content-Type\", \"application/json\").body(st).asJson();\r\n        System.out.println(\"Status: \" + repuestaServidor.getStatus());\r\n\r\n        System.out.println(\"Nuevo Formulario: \" + repuestaServidor.getBody());\r\n\r\n        return false;\r\n    }\r\n\r\n    public static List<Form> listForm(String usuario) {\r\n        try{\r\n            HttpResponse<String> r1 = Unirest.get(\"http://localhost:7000/restApi/formulario/listForm\" + \"{user}\").routeParam(\"user\", usuario).asString();\r\n            System.out.println(\"Status: \" + r1.getStatus());\r\n            System.out.println(r1.getBody());\r\n        }catch (Exception e){\r\n            e.printStackTrace();\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java b/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java
--- a/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/java/oppucmm/webservices/REST/Client/RESTClient.java	(date 1619565629085)
@@ -41,7 +41,7 @@
                 " Academic Level: " + form.getAcademicLevel());
         /*Json Image*/
         JsonObject imgJSON = new JsonObject();
-        imgJSON.addProperty("fotoBase64", form.getFotoBase64());
+        imgJSON.addProperty("photo", form.getFotoBase64());
         JsonObject st = new JsonObject();
         /*Adding properties*/
         st.addProperty("fullName", form.getFullName());
@@ -49,6 +49,9 @@
         st.addProperty("academicLevel", form.getAcademicLevel());
         st.addProperty("latitude", form.getLatitude());
         st.addProperty("longitude", form.getLongitude());
+       // st.addProperty("photo", form.getFotoBase64());
+        st.add("photo",imgJSON);
+
 
 
 
Index: build/resources/main/public/RestTemplate/formRest.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!doctype html>\r\n<html lang=\"en\" xmlns:th class=\"fullscreen-bg\">\r\n<head>\r\n    <title>Registro | OP-PUCMM</title>\r\n    <meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n    <!-- VENDOR CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/font-awesome/css/font-awesome.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/linearicons/style.css\">\r\n    <!-- MAIN CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/main.css\">\r\n    <!-- GOOGLE FONTS -->\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700\" rel=\"stylesheet\">\r\n    <!-- ICONS -->\r\n    <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"../assets/img/pucmm-logo.png\">\r\n    <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"../assets/img/favicon.png\">\r\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\" integrity=\"sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN\" crossorigin=\"anonymous\">\r\n\r\n    <style>\r\n        body {\r\n            background-color: #00A0F0;\r\n            font-family: 'Open Sans', sans-serif;\r\n            margin: 0;\r\n        }\r\n\r\n        .header h4 {\r\n            border-bottom: 1px solid #f0f0f0;\r\n            background-color: #f7f7f7;\r\n            padding: 20px 40px;\r\n            text-align: center;\r\n        }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n<!-- WRAPPER -->\r\n<div id=\"wrapper\">\r\n    <div class=\"vertical-align-wrap\">\r\n        <div class=\"vertical-align-middle\">\r\n            <div class=\"panel\" style=\"width: 800px; margin-left: auto; margin-right: auto;\">\r\n                <div class=\"left\">\r\n                    <div class=\"panel-body\">\r\n                        <div class=\"header\">\r\n                            <h4 class=\"lead\">REST CLIENT</h4>\r\n                            <form method=\"get\" action=\"/logOutRest\">\r\n                                <button type=\"submit\" class=\"btn btn-success\">\r\n                                    <a class=\"btn btn-success update-pro\" data-sm-link-text=\"CLICK\"\r\n                                       target=\"_blank\"><i class=\"fa fa-sign-out\"></i>\r\n                                        <span>LOG OUT</span></a>\r\n                                </button>\r\n                            </form>\r\n                        </div>\r\n                        <br>\r\n                        <form method=\"post\" class=\"form-auth-small\" action=\"/formRest/addForm\">\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-id-card\"></i></span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"fullNameRest\" id=\"fullNameRest\" placeholder=\"Nombre\" required onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\r\n                                    <input type=\"text\" class=\"form-control\" name=\"sectorRest\" id=\"sectorRest\" placeholder=\"Sector\" required  onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-file-picture-o\"></i></span>\r\n                                    <input  class=\"form-control\" name=\"fotoBase64\" id=\"fotoBase64\" type=\"file\"  placeholder=\"Foto\" required onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-paper-plane\"></i></span>\r\n                                    <select onclick=\"GEOLOCATION()\" name=\"academicLevelRest\" id=\"academicLevelRest\" placeholder=\"role\"\r\n                                            class=\"form-control\"\r\n                                            aria-required=\"true\" required>\r\n                                        <option value=\"\">Nivel Academico</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Basico\">Administrador</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Medio\">Medio</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Grado\">Grado</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Maestria\">Maestria</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Doctorado\">Doctorado</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <input type=\"hidden\" name=\"latitude\" id=\"latitude\" value=\"\">\r\n                            <input type=\"hidden\" id=\"longitude\" name=\"longitude\" value=\"\">\r\n                            <div class=\"col-md-12\">\r\n                                <br>\r\n                                <h6 DIV ALIGN=center th:text=\"${Error}\" style=\"color:#ff0000\"></h6>\r\n                                <h6 DIV ALIGN=center th:text=\"${Success}\" style=\"color:#00A0F0\"></h6>\r\n                            </div>\r\n                            <button type=\"submit\" class=\"btn btn-primary btn-lg btn-block\"><i class=\"fa fa-save\"></i>GUARDAR\r\n                                FORMULARIO\r\n                            </button>\r\n                            <p></p>\r\n                            <!-- END LOGIN ENTERING -->\r\n                            <div class=\"col-md-12\">\r\n                                <div class=\"panel\">\r\n                                    <div class=\"panel-body\">\r\n                                        <h3 class=\"panel-title\">LISTADO DE FORMULARIOS</h3>\r\n                                        <div class=\"table-responsive\">\r\n                                            <table class=\"table\" id=\"dataTable\">\r\n                                                <thead>\r\n                                                <tr>\r\n                                                    <th>#</th>\r\n                                                    <th>Nombre</th>\r\n                                                    <th>Sector</th>\r\n                                                    <th>Nivel Academico</th>\r\n                                                    <th>latitud</th>\r\n                                                    <th>Longitud</th>\r\n                                                    <th>Creado por</th>\r\n\r\n                                                </tr>\r\n                                                </thead>\r\n                                                <tbody>\r\n                                                <tr th:each=\"aux : ${formularios}\">\r\n                                                    <td th:text=\"${aux.id}\"></td>\r\n                                                    <td  >\r\n                                                        <img th:src=\"${aux.photo.fotoBase64}\" alt=\"Foto formulario\" style=\"height: 50px; width: 50px\" >\r\n                                                    </td>\r\n                                                    <td th:text=\"${aux.name}\"></td>\r\n                                                    <td th:text=\"${aux.sector}\"></td>\r\n                                                    <td th:text=\"${aux.academicLevel}\"></td>\r\n                                                    <td th:text=\"${aux.Location.latitude}\"></td>\r\n                                                    <td th:text=\"${aux.Location.longitude}\"></td>\r\n                                                    <td th:text=\"${aux.user.username}\"></td>\r\n                                                </tr>\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n                <div class=\"clearfix\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script>\r\n    function GEOLOCATION(){\r\n\r\n        function success(pos){\r\n            console.log('Working...')\r\n            var crd = pos.coords\r\n            document.querySelector(\"#latitude\").value = crd.latitude;\r\n            document.querySelector(\"#longitude\").value = crd.longitude;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(success)\r\n    }\r\n\r\n</script>\r\n\r\n\r\n<!-- END WRAPPER -->\r\n\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/build/resources/main/public/RestTemplate/formRest.html b/build/resources/main/public/RestTemplate/formRest.html
--- a/build/resources/main/public/RestTemplate/formRest.html	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/build/resources/main/public/RestTemplate/formRest.html	(date 1619578801291)
@@ -69,7 +69,7 @@
                             <div class="form-group">
                                 <div class="input-group">
                                     <span class="input-group-addon"><i class="fa fa-file-picture-o"></i></span>
-                                    <input  class="form-control" name="fotoBase64" id="fotoBase64" type="file"  placeholder="Foto" required onclick="GEOLOCATION()"/>
+                                    <input  class="form-control" name="foto" id="foto" type="file"  placeholder="Foto" required onclick="GEOLOCATION()"/>
                                 </div>
                             </div>
                             <div class="form-group">
@@ -108,6 +108,7 @@
                                                 <thead>
                                                 <tr>
                                                     <th>#</th>
+                                                    <th>Foto</th>
                                                     <th>Nombre</th>
                                                     <th>Sector</th>
                                                     <th>Nivel Academico</th>
@@ -120,8 +121,9 @@
                                                 <tbody>
                                                 <tr th:each="aux : ${formularios}">
                                                     <td th:text="${aux.id}"></td>
-                                                    <td  >
-                                                        <img th:src="${aux.photo.fotoBase64}" alt="Foto formulario" style="height: 50px; width: 50px" >
+                                                    <td>
+                                                        <img th:src="@{'data:' + ${aux.fotoList[0].mimeType} + '; base64,' + ${aux.fotoList[0].fotoBase64}}"
+                                                             width="50" height="50">
                                                     </td>
                                                     <td th:text="${aux.name}"></td>
                                                     <td th:text="${aux.sector}"></td>
Index: src/main/resources/public/RestTemplate/formRest.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!doctype html>\r\n<html lang=\"en\" xmlns:th class=\"fullscreen-bg\">\r\n<head>\r\n    <title>Registro | OP-PUCMM</title>\r\n    <meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\">\r\n    <!-- VENDOR CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/font-awesome/css/font-awesome.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../assets/vendor/linearicons/style.css\">\r\n    <!-- MAIN CSS -->\r\n    <link rel=\"stylesheet\" href=\"../assets/css/main.css\">\r\n    <!-- GOOGLE FONTS -->\r\n    <link href=\"https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700\" rel=\"stylesheet\">\r\n    <!-- ICONS -->\r\n    <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"../assets/img/pucmm-logo.png\">\r\n    <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"../assets/img/favicon.png\">\r\n    <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\" integrity=\"sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN\" crossorigin=\"anonymous\">\r\n\r\n    <style>\r\n        body {\r\n            background-color: #00A0F0;\r\n            font-family: 'Open Sans', sans-serif;\r\n            margin: 0;\r\n        }\r\n\r\n        .header h4 {\r\n            border-bottom: 1px solid #f0f0f0;\r\n            background-color: #f7f7f7;\r\n            padding: 20px 40px;\r\n            text-align: center;\r\n        }\r\n    </style>\r\n</head>\r\n\r\n<body>\r\n<!-- WRAPPER -->\r\n<div id=\"wrapper\">\r\n    <div class=\"vertical-align-wrap\">\r\n        <div class=\"vertical-align-middle\">\r\n            <div class=\"panel\" style=\"width: 800px; margin-left: auto; margin-right: auto;\">\r\n                <div class=\"left\">\r\n                    <div class=\"panel-body\">\r\n                        <div class=\"header\">\r\n                            <h4 class=\"lead\">REST CLIENT</h4>\r\n                            <form method=\"get\" action=\"/logOutRest\">\r\n                                <button type=\"submit\" class=\"btn btn-success\">\r\n                                    <a class=\"btn btn-success update-pro\" data-sm-link-text=\"CLICK\"\r\n                                       target=\"_blank\"><i class=\"fa fa-sign-out\"></i>\r\n                                        <span>LOG OUT</span></a>\r\n                                </button>\r\n                            </form>\r\n                        </div>\r\n                        <br>\r\n                        <form method=\"post\" class=\"form-auth-small\" action=\"/formRest/addForm\">\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-id-card\"></i></span>\r\n                                    <input  type=\"text\" class=\"form-control\" name=\"fullNameRest\" id=\"fullNameRest\" placeholder=\"Nombre\" required onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-map\"></i></span>\r\n                                    <input type=\"text\" class=\"form-control\" name=\"sectorRest\" id=\"sectorRest\" placeholder=\"Sector\" required  onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-file-picture-o\"></i></span>\r\n                                    <input  class=\"form-control\" name=\"fotoBase64\" id=\"fotoBase64\" type=\"file\"  placeholder=\"Foto\" required onclick=\"GEOLOCATION()\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div class=\"form-group\">\r\n                                <div class=\"input-group\">\r\n                                    <span class=\"input-group-addon\"><i class=\"fa fa-paper-plane\"></i></span>\r\n                                    <select onclick=\"GEOLOCATION()\" name=\"academicLevelRest\" id=\"academicLevelRest\" placeholder=\"role\"\r\n                                            class=\"form-control\"\r\n                                            aria-required=\"true\" required>\r\n                                        <option value=\"\">Nivel Academico</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Basico\">Administrador</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Medio\">Medio</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Grado\">Grado</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Maestria\">Maestria</option>\r\n                                        <option name=\"academicLevelRest\" value=\"Doctorado\">Doctorado</option>\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n                            <input type=\"hidden\" name=\"latitude\" id=\"latitude\" value=\"\">\r\n                            <input type=\"hidden\" id=\"longitude\" name=\"longitude\" value=\"\">\r\n                            <div class=\"col-md-12\">\r\n                                <br>\r\n                                <h6 DIV ALIGN=center th:text=\"${Error}\" style=\"color:#ff0000\"></h6>\r\n                                <h6 DIV ALIGN=center th:text=\"${Success}\" style=\"color:#00A0F0\"></h6>\r\n                            </div>\r\n                            <button type=\"submit\" class=\"btn btn-primary btn-lg btn-block\"><i class=\"fa fa-save\"></i>GUARDAR\r\n                                FORMULARIO\r\n                            </button>\r\n                            <p></p>\r\n                            <!-- END LOGIN ENTERING -->\r\n                            <div class=\"col-md-12\">\r\n                                <div class=\"panel\">\r\n                                    <div class=\"panel-body\">\r\n                                        <h3 class=\"panel-title\">LISTADO DE FORMULARIOS</h3>\r\n                                        <div class=\"table-responsive\">\r\n                                            <table class=\"table\" id=\"dataTable\">\r\n                                                <thead>\r\n                                                <tr>\r\n                                                    <th>#</th>\r\n                                                    <th>Nombre</th>\r\n                                                    <th>Sector</th>\r\n                                                    <th>Nivel Academico</th>\r\n                                                    <th>latitud</th>\r\n                                                    <th>Longitud</th>\r\n                                                    <th>Creado por</th>\r\n\r\n                                                </tr>\r\n                                                </thead>\r\n                                                <tbody>\r\n                                                <tr th:each=\"aux : ${formularios}\">\r\n                                                    <td th:text=\"${aux.id}\"></td>\r\n                                                    <td  >\r\n                                                        <img th:src=\"${aux.photo.fotoBase64}\" alt=\"Foto formulario\" style=\"height: 50px; width: 50px\" >\r\n                                                    </td>\r\n                                                    <td th:text=\"${aux.name}\"></td>\r\n                                                    <td th:text=\"${aux.sector}\"></td>\r\n                                                    <td th:text=\"${aux.academicLevel}\"></td>\r\n                                                    <td th:text=\"${aux.Location.latitude}\"></td>\r\n                                                    <td th:text=\"${aux.Location.longitude}\"></td>\r\n                                                    <td th:text=\"${aux.user.username}\"></td>\r\n                                                </tr>\r\n                                                </tbody>\r\n                                            </table>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n                <div class=\"clearfix\"></div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<script>\r\n    function GEOLOCATION(){\r\n\r\n        function success(pos){\r\n            console.log('Working...')\r\n            var crd = pos.coords\r\n            document.querySelector(\"#latitude\").value = crd.latitude;\r\n            document.querySelector(\"#longitude\").value = crd.longitude;\r\n        }\r\n        navigator.geolocation.getCurrentPosition(success)\r\n    }\r\n\r\n</script>\r\n\r\n\r\n<!-- END WRAPPER -->\r\n\r\n</body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/resources/public/RestTemplate/formRest.html b/src/main/resources/public/RestTemplate/formRest.html
--- a/src/main/resources/public/RestTemplate/formRest.html	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/resources/public/RestTemplate/formRest.html	(date 1619565629397)
@@ -69,7 +69,7 @@
                             <div class="form-group">
                                 <div class="input-group">
                                     <span class="input-group-addon"><i class="fa fa-file-picture-o"></i></span>
-                                    <input  class="form-control" name="fotoBase64" id="fotoBase64" type="file"  placeholder="Foto" required onclick="GEOLOCATION()"/>
+                                    <input  class="form-control" name="foto" id="foto" type="file"  placeholder="Foto" required onclick="GEOLOCATION()"/>
                                 </div>
                             </div>
                             <div class="form-group">
@@ -108,6 +108,7 @@
                                                 <thead>
                                                 <tr>
                                                     <th>#</th>
+                                                    <th>Foto</th>
                                                     <th>Nombre</th>
                                                     <th>Sector</th>
                                                     <th>Nivel Academico</th>
@@ -120,8 +121,9 @@
                                                 <tbody>
                                                 <tr th:each="aux : ${formularios}">
                                                     <td th:text="${aux.id}"></td>
-                                                    <td  >
-                                                        <img th:src="${aux.photo.fotoBase64}" alt="Foto formulario" style="height: 50px; width: 50px" >
+                                                    <td>
+                                                        <img th:src="@{'data:' + ${aux.fotoList[0].mimeType} + '; base64,' + ${aux.fotoList[0].fotoBase64}}"
+                                                             width="50" height="50">
                                                     </td>
                                                     <td th:text="${aux.name}"></td>
                                                     <td th:text="${aux.sector}"></td>
Index: .idea/gradle.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"GradleMigrationSettings\" migrationVersion=\"1\" />\r\n  <component name=\"GradleSettings\">\r\n    <option name=\"linkedExternalProjectsSettings\">\r\n      <GradleProjectSettings>\r\n        <option name=\"distributionType\" value=\"DEFAULT_WRAPPED\" />\r\n        <option name=\"externalProjectPath\" value=\"$PROJECT_DIR$\" />\r\n        <option name=\"modules\">\r\n          <set>\r\n            <option value=\"$PROJECT_DIR$\" />\r\n          </set>\r\n        </option>\r\n      </GradleProjectSettings>\r\n    </option>\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/gradle.xml b/.idea/gradle.xml
--- a/.idea/gradle.xml	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/.idea/gradle.xml	(date 1619580707203)
@@ -4,8 +4,11 @@
   <component name="GradleSettings">
     <option name="linkedExternalProjectsSettings">
       <GradleProjectSettings>
+        <option name="delegatedBuild" value="true" />
+        <option name="testRunner" value="GRADLE" />
         <option name="distributionType" value="DEFAULT_WRAPPED" />
         <option name="externalProjectPath" value="$PROJECT_DIR$" />
+        <option name="gradleJvm" value="11" />
         <option name="modules">
           <set>
             <option value="$PROJECT_DIR$" />
Index: src/main/java/oppucmm/webservices/REST/Server/RESTController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package oppucmm.webservices.REST.Server;\r\n\r\nimport io.javalin.Javalin;\r\nimport kong.unirest.Client;\r\nimport oppucmm.controllers.Controller;\r\nimport oppucmm.models.Form;\r\nimport oppucmm.models.FormAux;\r\nimport oppucmm.models.Photo;\r\nimport oppucmm.models.User;\r\nimport oppucmm.services.FormService;\r\nimport oppucmm.services.UserService;\r\nimport oppucmm.webservices.REST.Client.RESTClient;\r\nimport org.jasypt.encryption.pbe.StandardPBEStringEncryptor;\r\n\r\nimport java.io.IOException;\r\nimport java.util.*;\r\n\r\nimport static io.javalin.apibuilder.ApiBuilder.*;\r\n\r\npublic class RESTController {\r\n    public final static String KEY_SECRET = \"asd12D1234dfr123@#4Fsdcasdd5g78a\";\r\n    public final static int UNAUTHORIZED = 401;\r\n    public final static int NOT_FOUND = 404;\r\n    private static String mpCryptoPassword = \"BornToFight\";\r\n    private FormService formService = FormService.getInstance();\r\n\r\n    static String URI = \"\";\r\n    private Javalin app;\r\n    private Map<String, Object> model = new HashMap<>();\r\n\r\n    public RESTController(Javalin app) {\r\n        this.app = app;\r\n    }\r\n\r\n    public void aplicarRutas() {\r\n        app.get(\"/\", ctx -> ctx.redirect(\"/formRest\"));\r\n        app.routes(() -> {\r\n            path(\"/formRest\", () -> {\r\n                before(\"/\", ctx -> {\r\n                    if (ctx.sessionAttribute(\"user\") == null) {\r\n                        ctx.redirect(\"/loginRest\");\r\n                    }\r\n                });\r\n                get(\"/\", ctx -> {\r\n                    model.put(\"formularios\",Controller.getInstance().listForm());\r\n                  //  model.put(\"formularios\",RESTClient.listForm(ctx.sessionAttribute(\"user\")));\r\n                    model.put(\"user\", ctx.sessionAttribute(\"user\"));\r\n                    ctx.render(\"public/RestTemplate/formRest.html\", model);\r\n                });\r\n                post(\"/addForm\",ctx -> {\r\n                    Double longitude = ctx.formParam(\"longitude\",Double.class).get();\r\n                    Double latitude = ctx.formParam(\"latitude\",Double.class).get();\r\n                    List<Photo> misFotos = new ArrayList<>();\r\n\r\n\r\n                    ctx.uploadedFiles(\"foto\").forEach(uploadedFile -> {\r\n                        System.out.println(\"\\n ENTRANDO A METODO PARA CARGAR IMAGENES.... \\n\");\r\n                        try {\r\n                            byte[] bytes = uploadedFile.getContent().readAllBytes();\r\n                            String encodedString = Base64.getEncoder().encodeToString(bytes);\r\n                            Photo foto = new Photo(encodedString);\r\n                            misFotos.add(foto);\r\n                        } catch (IOException e) {\r\n                            e.printStackTrace();\r\n                        }\r\n                    });\r\n                    if(misFotos.size() > 0){\r\n                        /*\r\n                        FormAux f1 = new FormAux(ctx.formParam(\"fullNameRest\"),\r\n                                ctx.formParam(\"sectorRest\"),\r\n                                ctx.formParam(\"academicLevelRest\"),longitude,latitude);\r\n                        */\r\n                    }\r\n                    /*\r\n                    if(RESTClient.addForm(f1)== false){\r\n                        System.out.println(\"no se pudo agregar\");\r\n                    }else{\r\n                        System.out.println(\"Se pudo agregar\");\r\n                    }\r\n                    ctx.redirect(\"/formRest\");\r\n\r\n                     */\r\n                });\r\n            });\r\n            path(\"/logOutRest\", () -> {\r\n                get(\"/\", ctx -> {\r\n                    if (ctx.sessionAttribute(\"user\") != null) {\r\n                        ctx.sessionAttribute(\"user\", null);\r\n                        ctx.req.getSession().invalidate();\r\n                    }\r\n                    if (ctx.cookie(\"user\") != null) {\r\n                        ctx.removeCookie(\"user\");\r\n                    }\r\n                    ctx.redirect(\"/\");\r\n                });\r\n\r\n            });\r\n        });\r\n        app.post(\"/loginRest\", ctx -> {\r\n            String rememberMe = \"\";\r\n            Map<String, Object> modelo = new HashMap<>();\r\n            String username = ctx.formParam(\"username\");\r\n            String password = ctx.formParam(\"password\");\r\n            //Authenticator\r\n            User aux = UserService.getInstance().buscar(username);\r\n            if (aux!=null) {\r\n                if (aux.getPassword().equals(password)) {\r\n                    rememberMe = ctx.formParam(\"rememberMe\");\r\n                    if (rememberMe != null) {\r\n                        if (rememberMe.equalsIgnoreCase(\"ON\")) {\r\n                            System.out.println(\"Creando cookie...\\n\");\r\n                            StandardPBEStringEncryptor encryptor = new StandardPBEStringEncryptor();\r\n                            encryptor.setPassword(mpCryptoPassword);\r\n                            encryptor.encrypt(aux.getPassword());\r\n                            ctx.cookie(\"username\", aux.getUsername(), 604800);\r\n                            ctx.cookie(\"password\", encryptor.encrypt(aux.getPassword()), 604800);\r\n                        } else {\r\n                            System.out.println(\"Cookie no pudo ser creada...\\n\");\r\n                        }\r\n                    }\r\n                    System.out.println(\"username \" + aux.getUsername() + \" entered to system [REST-CLIENT]\");\r\n                    ctx.sessionAttribute(\"user\", username);\r\n                    ctx.redirect(\"/formRest\");\r\n                } else {\r\n                    System.out.println(\"User: \" + aux.getUsername() + \" entered an incorrect password\");\r\n                    modelo.put(\"Error\", \"Contraseña incorrecta!\");\r\n                }\r\n            }\r\n            ctx.render(\"public/RestTemplate/loginRest.html\", modelo);\r\n\r\n        });\r\n        app.get(\"/loginRest\", ctx -> {\r\n            ctx.render(\"public/RestTemplate/loginRest.html\");\r\n        });\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/main/java/oppucmm/webservices/REST/Server/RESTController.java b/src/main/java/oppucmm/webservices/REST/Server/RESTController.java
--- a/src/main/java/oppucmm/webservices/REST/Server/RESTController.java	(revision 11493a3205df466b1192321344334b4571198480)
+++ b/src/main/java/oppucmm/webservices/REST/Server/RESTController.java	(date 1619578788110)
@@ -65,21 +65,19 @@
                         }
                     });
                     if(misFotos.size() > 0){
-                        /*
+
                         FormAux f1 = new FormAux(ctx.formParam("fullNameRest"),
                                 ctx.formParam("sectorRest"),
-                                ctx.formParam("academicLevelRest"),longitude,latitude);
-                        */
-                    }
-                    /*
-                    if(RESTClient.addForm(f1)== false){
-                        System.out.println("no se pudo agregar");
-                    }else{
-                        System.out.println("Se pudo agregar");
+                                ctx.formParam("academicLevelRest"),longitude,latitude,misFotos);
+                        if(RESTClient.addForm(f1)== false){
+                            System.out.println("no se pudo agregar");
+                        }else{
+                            System.out.println("Se pudo agregar");
+                        }
                     }
                     ctx.redirect("/formRest");
 
-                     */
+
                 });
             });
             path("/logOutRest", () -> {
